% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/abundance.R
\name{generate_heterogeneous_distribution}
\alias{generate_heterogeneous_distribution}
\title{Generate a heterogeneous community (point process + environment + interactions)}
\usage{
generate_heterogeneous_distribution(domain, P)
}
\arguments{
\item{domain}{An \pkg{sf} polygon (or multipolygon) defining the sampling
domain; must have a valid CRS (projected coordinates recommended).}

\item{P}{A fully materialized parameter list, typically from
\code{\link{load_config}()}, containing at least:
\itemize{
\item \emph{Community size:} \code{N_SPECIES}, \code{N_INDIVIDUALS},
\code{DOMINANT_FRACTION}, \code{FISHER_ALPHA}, \code{FISHER_X}.
\item \emph{Environment:} \code{SAMPLING_RESOLUTION}, \code{ENVIRONMENTAL_NOISE},
and \code{GRADIENT} (tibble with \code{species}, \code{gradient} in
\{temperature, elevation, rainfall\}, \code{optimum} in \eqn{[0,1]},
and \code{tol > 0}). If absent, species are treated as neutral.
\item \emph{Point-process selection (strings):}
\code{SPATIAL_PROCESS_A} and \code{SPATIAL_PROCESS_OTHERS} in
\code{"poisson"}, \code{"thomas"}, \code{"strauss"}, or \code{"geyer"}.
\item \emph{Thomas (A) params (if used):}
\code{A_PARENT_INTENSITY} (parents per area; optional),
\code{A_MEAN_OFFSPRING} (mean children per parent),
\code{A_CLUSTER_SCALE} (Gaussian sd of offspring displacement; map units).
\item \emph{Strauss/Geyer (others) params (if used):}
\code{OTHERS_R} (interaction radius),
\code{OTHERS_GAMMA} (interaction parameter; \code{< 1} inhibition, \code{> 1} attraction),
\code{OTHERS_S} (Geyer saturation count; ignored by Strauss),
\code{OTHERS_BETA} (baseline intensity/multiplier; optional).
\item \emph{Local interactions:} \code{INTERACTION_RADIUS} (map units) and
\code{INTERACTION_MATRIX} (S x S numeric, dimnames = species letters).
}}
}
\value{
An \pkg{sf} POINT layer with a character column \code{species} and
appended environmental columns (e.g. \code{temperature_C}, \code{elevation_m},
\code{rainfall_mm}). Rows correspond to simulated individuals retained after
assignment.
}
\description{
Generates individual locations and species identities over an arbitrary polygon
domain by combining:
\enumerate{
\item a spatial point process for baseline locations (clustered, inhibited, or Poisson),
\item environmental filtering for gradient-responsive species, and
\item local interspecific interactions within a neighbourhood radius.
}
The dominant species "A" and the pool of non-dominant species can use
different point-process models. Environmental suitability is applied as a
Gaussian preference around a per-species optimum, and local interactions are
incorporated as a multiplicative modifier computed from nearby already-assigned
individuals.
}
\details{
\strong{Abundances.} Total individuals per species are drawn with
\code{\link{generate_fisher_log_series}()}, allocating a fixed fraction to
species "A" and distributing the remainder by a log-series across
\code{B, C, ...}.

\strong{Baseline locations (point processes).} Locations are simulated using
the process names in \code{P}. Supported values (case-insensitive):
\describe{
\item{\code{"poisson"}}{Homogeneous Poisson inside \code{domain}.}
\item{\code{"thomas"}}{Thomas (Neyman-Scott) cluster process; uses parent intensity
(derived if missing), mean offspring, and Gaussian cluster scale. Implemented internally.}
\item{\code{"strauss"}}{Inhibition via a sequential-inhibition surrogate using
interaction radius \code{OTHERS_R} and inhibition strength \code{OTHERS_S} in \eqn{(0,1]}.
Lower \code{OTHERS_S} increases inhibition.}
\item{\code{"geyer"}}{Geyer saturation surrogate: acceptance probability proportional to
\eqn{\gamma^{\min(m, s)}} where \eqn{m} neighbours fall within \code{OTHERS_R} and
saturation count \code{OTHERS_S}. Implemented internally.}
}

\strong{Environmental filtering.} For species listed in \code{P$GRADIENT},
the assignment probability for each species is proportional to
\eqn{\exp\{-(x - \mu)^2 / (2 \sigma^2)\}}, where \eqn{x} is the normalized
environmental value at the point, \eqn{\mu} the species optimum, and
\eqn{\sigma} the tolerance. Environmental values are attached by nearest
neighbour join to the grid returned by \code{\link{create_environmental_gradients}()}.

\strong{Local interactions.} For each candidate point and focal species,
the abundance-independent interaction modifier is the geometric mean of the
corresponding coefficients in \code{P$INTERACTION_MATRIX} for neighbours found
within \code{P$INTERACTION_RADIUS} (using up to 5 nearest already-assigned
individuals). Coefficients \code{> 1} favour co-occurrence; \code{< 1} penalize it.

\strong{Tie-breaking and robustness.} If all weights for a step are
non-finite or non-positive, a uniform assignment is used for that step to
avoid dead ends. Only points with a non-empty \code{species} are returned.
}
\section{Notes}{

\itemize{
\item Use a projected CRS (e.g. metres) so that process radii and cluster
scales are in meaningful linear units.
\item When \code{SPATIAL_PROCESS_OTHERS} is inhibitory and \code{n} is large
relative to \code{OTHERS_R} and domain area, you may hit feasibility limits;
adjust \code{n}, \code{r}, or choose a different process.
\item Setting \code{INTERACTION_RADIUS = 0} or an all-ones matrix disables
local interaction effects.
}
}

\examples{
\dontrun{
P <- load_config("simul_init.txt")
domain <- create_sampling_domain()

# Example: A clustered (Thomas), others mildly inhibited (Strauss)
P$SPATIAL_PROCESS_A <- "thomas"
P$A_PARENT_INTENSITY <- NA
P$A_MEAN_OFFSPRING <- 10
P$A_CLUSTER_SCALE <- 0.8

P$SPATIAL_PROCESS_OTHERS <- "strauss"
P$OTHERS_R <- 0.6
P$OTHERS_S <- 0.5

pts <- generate_heterogeneous_distribution(domain, P)
plot(sf::st_geometry(pts), pch = 16, cex = 0.4)
}

}
\seealso{
\code{\link{create_environmental_gradients}()},
\code{\link{generate_fisher_log_series}()},
\code{\link{load_config}()},
\code{\link{load_interactions}()}
}
