% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/matrices.R
\name{calculate_quadrat_environment}
\alias{calculate_quadrat_environment}
\title{Summarise mean environmental conditions per quadrat}
\usage{
calculate_quadrat_environment(env_grid, quadrats, domain_crs)
}
\arguments{
\item{env_grid}{A regular (or irregular) data frame with numeric columns
\code{x}, \code{y} giving point coordinates, and environmental columns
\code{temperature_C}, \code{elevation_m}, \code{rainfall_mm}. Coordinates
are assumed to be in the CRS specified by \code{domain_crs}.}

\item{quadrats}{An \code{sf} POLYGON (or MULTIPOLYGON) layer with a
\code{quadrat_id} column. Must be in the same CRS as \code{domain_crs}.}

\item{domain_crs}{A coordinate reference system for \code{env_grid} points.
Can be an integer EPSG code, a PROJ4string/WKT, or an \code{sf} \code{crs}
object. This CRS should match that of \code{quadrats}.}
}
\value{
A \code{data.frame} with one row per quadrat and columns:
\code{site}, \code{temperature_C}, \code{elevation_m}, \code{rainfall_mm}.
Means are numeric; sites with no overlapping points will have \code{NA} in
the environmental columns.
}
\description{
Converts a gridded environmental table (\code{env_grid}) into an \code{sf}
point layer, joins it to quadrat polygons, and computes per‑quadrat mean
values (temperature, elevation, rainfall). Quadrats with no overlapping
grid points are retained and returned with \code{NA} means.
}
\details{
The function:
\enumerate{
\item converts \code{env_grid} to \code{sf} points via
\code{\link[sf]{st_as_sf}} using \code{coords = c("x","y")},
\item performs a spatial join \code{\link[sf]{st_join}} of points into
quadrats (default predicate: \code{st_intersects}),
\item groups by \code{quadrat_id} and returns the mean of each
environmental variable (with \code{na.rm = TRUE}),
\item left‑joins back to the full set of quadrats to keep empty sites.
}
If you prefer a different join logic (e.g., nearest neighbour), adapt the
join call to specify a different predicate or use \code{st_nearest_feature}.
}
\section{CRS}{

\code{env_grid} is interpreted in \code{domain_crs}; \code{quadrats} must
already be in the same CRS. Reproject beforehand as needed.
}

\examples{
\dontrun{
env <- create_environmental_gradients(domain, resolution = 50, noise_level = 0.05)
E <- calculate_quadrat_environment(env, quadrats, domain_crs = sf::st_crs(domain))
head(E)
}
}
\seealso{
\code{\link[sf]{st_as_sf}}, \code{\link[sf]{st_join}}, \code{\link{create_environmental_gradients}}
}
