<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate a heterogeneous community (point process + environment + interactions) — generate_heterogeneous_distribution • spesim</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate a heterogeneous community (point process + environment + interactions) — generate_heterogeneous_distribution"><meta name="description" content='Generates individual locations and species identities over an arbitrary polygon
domain by combining:
a spatial point process for baseline locations (clustered, inhibited, or Poisson),
environmental filtering for gradient-responsive species, and
local interspecific interactions within a neighbourhood radius.
The dominant species "A" and the pool of non-dominant species can use
different point-process models. Environmental suitability is applied as a
Gaussian preference around a per-species optimum, and local interactions are
incorporated as a multiplicative modifier computed from nearby already-assigned
individuals.'><meta property="og:description" content='Generates individual locations and species identities over an arbitrary polygon
domain by combining:
a spatial point process for baseline locations (clustered, inhibited, or Poisson),
environmental filtering for gradient-responsive species, and
local interspecific interactions within a neighbourhood radius.
The dominant species "A" and the pool of non-dominant species can use
different point-process models. Environmental suitability is applied as a
Gaussian preference around a per-species optimum, and local interactions are
incorporated as a multiplicative modifier computed from nearby already-assigned
individuals.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spesim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/spesim-init-parameters.html">spesim: Full Init File Parameters</a></li>
    <li><a class="dropdown-item" href="../articles/spesim-interactions.html">spesim: Defining Interspecific Interactions</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ajsmit/spesim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate a heterogeneous community (point process + environment + interactions)</h1>
      <small class="dont-index">Source: <a href="https://github.com/ajsmit/spesim/blob/HEAD/R/abundance.R" class="external-link"><code>R/abundance.R</code></a></small>
      <div class="d-none name"><code>generate_heterogeneous_distribution.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Generates individual locations and species identities over an arbitrary polygon
domain by combining:</p><ol><li><p>a spatial point process for baseline locations (clustered, inhibited, or Poisson),</p></li>
<li><p>environmental filtering for gradient-responsive species, and</p></li>
<li><p>local interspecific interactions within a neighbourhood radius.</p></li>
</ol><p>The dominant species "A" and the pool of non-dominant species can use
different point-process models. Environmental suitability is applied as a
Gaussian preference around a per-species optimum, and local interactions are
incorporated as a multiplicative modifier computed from nearby already-assigned
individuals.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">generate_heterogeneous_distribution</span><span class="op">(</span><span class="va">domain</span>, <span class="va">P</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-domain">domain<a class="anchor" aria-label="anchor" href="#arg-domain"></a></dt>
<dd><p>An <span class="pkg">sf</span> polygon (or multipolygon) defining the sampling
domain; must have a valid CRS (projected coordinates recommended).</p></dd>


<dt id="arg-p">P<a class="anchor" aria-label="anchor" href="#arg-p"></a></dt>
<dd><p>A fully materialized parameter list, typically from
<code><a href="load_config.html">load_config</a>()</code>, containing at least:</p><ul><li><p><em>Community size:</em> <code>N_SPECIES</code>, <code>N_INDIVIDUALS</code>,
<code>DOMINANT_FRACTION</code>, <code>FISHER_ALPHA</code>, <code>FISHER_X</code>.</p></li>
<li><p><em>Environment:</em> <code>SAMPLING_RESOLUTION</code>, <code>ENVIRONMENTAL_NOISE</code>,
and <code>GRADIENT</code> (tibble with <code>species</code>, <code>gradient</code> in
{temperature, elevation, rainfall}, <code>optimum</code> in \([0,1]\),
and <code>tol &gt; 0</code>). If absent, species are treated as neutral.</p></li>
<li><p><em>Point-process selection (strings):</em>
<code>SPATIAL_PROCESS_A</code> and <code>SPATIAL_PROCESS_OTHERS</code> in
<code>"poisson"</code>, <code>"thomas"</code>, <code>"strauss"</code>, or <code>"geyer"</code>.</p></li>
<li><p><em>Thomas (A) params (if used):</em>
<code>A_PARENT_INTENSITY</code> (parents per area; optional),
<code>A_MEAN_OFFSPRING</code> (mean children per parent),
<code>A_CLUSTER_SCALE</code> (Gaussian sd of offspring displacement; map units).</p></li>
<li><p><em>Strauss/Geyer (others) params (if used):</em>
<code>OTHERS_R</code> (interaction radius),
<code>OTHERS_GAMMA</code> (interaction parameter; <code>&lt; 1</code> inhibition, <code>&gt; 1</code> attraction),
<code>OTHERS_S</code> (Geyer saturation count; ignored by Strauss),
<code>OTHERS_BETA</code> (baseline intensity/multiplier; optional).</p></li>
<li><p><em>Local interactions:</em> <code>INTERACTION_RADIUS</code> (map units) and
<code>INTERACTION_MATRIX</code> (S x S numeric, dimnames = species letters).</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <span class="pkg">sf</span> POINT layer with a character column <code>species</code> and
appended environmental columns (e.g. <code>temperature_C</code>, <code>elevation_m</code>,
<code>rainfall_mm</code>). Rows correspond to simulated individuals retained after
assignment.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Abundances.</strong> Total individuals per species are drawn with
<code><a href="generate_fisher_log_series.html">generate_fisher_log_series</a>()</code>, allocating a fixed fraction to
species "A" and distributing the remainder by a log-series across
<code>B, C, ...</code>.</p>
<p><strong>Baseline locations (point processes).</strong> Locations are simulated using
the process names in <code>P</code>. Supported values (case-insensitive):</p><dl><dt><code>"poisson"</code></dt>
<dd><p>Homogeneous Poisson inside <code>domain</code>.</p></dd>

<dt><code>"thomas"</code></dt>
<dd><p>Thomas (Neyman-Scott) cluster process; uses parent intensity
(derived if missing), mean offspring, and Gaussian cluster scale. Implemented internally.</p></dd>

<dt><code>"strauss"</code></dt>
<dd><p>Inhibition via a sequential-inhibition surrogate using
interaction radius <code>OTHERS_R</code> and inhibition strength <code>OTHERS_S</code> in \((0,1]\).
Lower <code>OTHERS_S</code> increases inhibition.</p></dd>

<dt><code>"geyer"</code></dt>
<dd><p>Geyer saturation surrogate: acceptance probability proportional to
\(\gamma^{\min(m, s)}\) where \(m\) neighbours fall within <code>OTHERS_R</code> and
saturation count <code>OTHERS_S</code>. Implemented internally.</p></dd>


</dl><p><strong>Environmental filtering.</strong> For species listed in <code>P$GRADIENT</code>,
the assignment probability for each species is proportional to
\(\exp\{-(x - \mu)^2 / (2 \sigma^2)\}\), where \(x\) is the normalized
environmental value at the point, \(\mu\) the species optimum, and
\(\sigma\) the tolerance. Environmental values are attached by nearest
neighbour join to the grid returned by <code><a href="create_environmental_gradients.html">create_environmental_gradients</a>()</code>.</p>
<p><strong>Local interactions.</strong> For each candidate point and focal species,
the abundance-independent interaction modifier is the geometric mean of the
corresponding coefficients in <code>P$INTERACTION_MATRIX</code> for neighbours found
within <code>P$INTERACTION_RADIUS</code> (using up to 5 nearest already-assigned
individuals). Coefficients <code>&gt; 1</code> favour co-occurrence; <code>&lt; 1</code> penalize it.</p>
<p><strong>Tie-breaking and robustness.</strong> If all weights for a step are
non-finite or non-positive, a uniform assignment is used for that step to
avoid dead ends. Only points with a non-empty <code>species</code> are returned.</p>
    </div>
    <div class="section level2">
    <h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a></h2>


<ul><li><p>Use a projected CRS (e.g. metres) so that process radii and cluster
scales are in meaningful linear units.</p></li>
<li><p>When <code>SPATIAL_PROCESS_OTHERS</code> is inhibitory and <code>n</code> is large
relative to <code>OTHERS_R</code> and domain area, you may hit feasibility limits;
adjust <code>n</code>, <code>r</code>, or choose a different process.</p></li>
<li><p>Setting <code>INTERACTION_RADIUS = 0</code> or an all-ones matrix disables
local interaction effects.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="create_environmental_gradients.html">create_environmental_gradients</a>()</code>,
<code><a href="generate_fisher_log_series.html">generate_fisher_log_series</a>()</code>,
<code><a href="load_config.html">load_config</a>()</code>,
<code><a href="load_interactions.html">load_interactions</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="load_config.html">load_config</a></span><span class="op">(</span><span class="st">"simul_init.txt"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">domain</span> <span class="op">&lt;-</span> <span class="fu"><a href="create_sampling_domain.html">create_sampling_domain</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example: A clustered (Thomas), others mildly inhibited (Strauss)</span></span></span>
<span class="r-in"><span><span class="va">P</span><span class="op">$</span><span class="va">SPATIAL_PROCESS_A</span> <span class="op">&lt;-</span> <span class="st">"thomas"</span></span></span>
<span class="r-in"><span><span class="va">P</span><span class="op">$</span><span class="va">A_PARENT_INTENSITY</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="va">P</span><span class="op">$</span><span class="va">A_MEAN_OFFSPRING</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">P</span><span class="op">$</span><span class="va">A_CLUSTER_SCALE</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">P</span><span class="op">$</span><span class="va">SPATIAL_PROCESS_OTHERS</span> <span class="op">&lt;-</span> <span class="st">"strauss"</span></span></span>
<span class="r-in"><span><span class="va">P</span><span class="op">$</span><span class="va">OTHERS_R</span> <span class="op">&lt;-</span> <span class="fl">0.6</span></span></span>
<span class="r-in"><span><span class="va">P</span><span class="op">$</span><span class="va">OTHERS_S</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu">generate_heterogeneous_distribution</span><span class="op">(</span><span class="va">domain</span>, <span class="va">P</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">pts</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by AJ Smit.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

